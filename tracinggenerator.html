<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edurary Lined Tracing Worksheet Generator</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        #controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        input[type="text"], select, textarea {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
        }
        #textInput {
            width: 300px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            font-size: 1em;
        }
        button:hover {
            background-color: #0056b3;
        }
        #outputArea {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Header Styles */
        #worksheetHeader {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding-bottom: 10px;
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
            font-size: 0.9em;
        }
        .headerField {
            flex-grow: 1;
            margin-right: 20px;
        }
        .headerField span {
            font-weight: bold;
            margin-right: 5px;
        }
        .headerField .line {
            display: inline-block;
            width: 150px;
            border-bottom: 1px solid black;
        }
        #branding {
            font-size: 0.8em;
            color: #666;
            font-style: italic;
        }

        /* Styles for printing */
        @media print {
            #controls, #copyButton {
                display: none;
            }
            body {
                margin: 0;
                background-color: white;
            }
            #outputArea {
                box-shadow: none;
                padding: 20px;
                margin: 0;
            }
            #worksheetHeader {
                border-bottom: 1px solid black;
            }
            .headerField .line {
                border-bottom: 1px solid black;
            }
        }
    </style>
</head>
<body>

    <div id="controls">
        <h3>✏️ Tracing Generator</h3>
        
        <select id="modeSelector" onchange="switchMode()">
            <option value="words">Word Mode</option>
            <option value="sentences">Sentence Mode</option>
        </select>

        <select id="themeSelector" onchange="loadTheme()">
            </select>
        
        <textarea id="textInput" placeholder="Enter one word/sentence per line" rows="5" cols="40">EduraryLLC</textarea>
        
        <select id="fontStyle" onchange="generateTracingText()">
            <option value="print">Print Style</option>
            <option value="cursive">Cursive Style</option>
        </select>
        
        <select id="fontSize" onchange="generateTracingText()">
            <option value="70">Large (70px)</option>
            <option value="60">Medium (60px)</option>
            <option value="50">Small (50px)</option>
        </select>
        
        <select id="textCase" onchange="generateTracingText()">
            <option value="default">Keep Case</option>
            <option value="uppercase">ALL CAPS (For Capitals)</option>
            <option value="lowercase">all lower (For Lowercase)</option>
        </select>

        <button onclick="generateTracingText()">Generate</button>
        <button id="printButton" onclick="window.print()">Print Page</button>
        <button id="copyButton" onclick="copySVGCode()">Copy SVG Code</button>
    </div>

    <div id="outputArea">
        
        <div id="worksheetHeader">
            <div class="headerField">
                <span>Name:</span> <span class="line"></span>
            </div>
            <div class="headerField">
                <span>Date:</span> <span class="line"></span>
            </div>
            <div class="headerField">
                <span>Class:</span> <span class="line"></span>
            </div>
            <div id="branding">
                Worksheet generated by **EDURARY**
            </div>
        </div>
        <svg id="tracingSVG" width="100%" height="450" viewBox="0 0 1000 450">
            <text x="50" y="50" dominant-baseline="middle">Start Tracing!</text>
        </svg>
    </div>

    <script>
        // Dictionary of themes. Note: words/sentences are ARRAYS.
        const themes = {
            words: {
                custom: ["EduraryLLC", "Tracing Generator"], 
                shapes: ["Circle", "Square", "Triangle", "Star", "Heart", "Oval"],
                colors: ["Red", "Orange", "Yellow", "Green", "Blue", "Purple", "Pink"],
                alphabet_upper: ["A B C D E", "F G H I J", "K L M N O", "P Q R S T", "U V W X Y Z"],
                alphabet_lower: ["a b c d e", "f g h i j", "k l m n o", "p q r s t", "u v w x y z"],
            },
            sentences: {
                custom: ["The quick brown fox jumps over the lazy dog."], 
                greetings: ["Hello, how are you today?", "Thank you for the help.", "Have a wonderful day!"],
                famous: ["The only way to do great work is to love what you do.", "Where there is love, there is life."],
            }
        };

        let currentMode = 'words';
        
        // SVG Layout Constants (BASE LINE_HEIGHT is now determined by font size)
        const START_X = 50; // Horizontal start position
        const START_Y = 50; // Vertical starting offset for the first line of text
        const BASELINE_ADJUSTMENT = 0.8; // Multiplier to set line height relative to font size
        const TEXT_Y_OFFSET = 0.2; // Multiplier to set text baseline offset

        document.addEventListener('DOMContentLoaded', () => {
            populateThemeOptions('words');
            document.getElementById('textInput').value = themes.words.custom.join('\n');
            generateTracingText();
        });

        function populateThemeOptions(mode) {
            const selector = document.getElementById('themeSelector');
            selector.innerHTML = ''; 
            currentMode = mode; 

            const customOption = document.createElement('option');
            customOption.value = 'custom';
            customOption.textContent = (mode === 'words' ? 'Custom Words' : 'Custom Sentences');
            selector.appendChild(customOption);

            for (const key in themes[mode]) {
                if (key !== 'custom') {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = key.charAt(0).toUpperCase() + key.slice(1).replace('_', ' ') + ' Theme';
                    selector.appendChild(option);
                }
            }
        }

        function switchMode() {
            const modeSelect = document.getElementById('modeSelector');
            populateThemeOptions(modeSelect.value);
            loadTheme();
        }

        function loadTheme() {
            const selector = document.getElementById('themeSelector');
            const themeKey = selector.value;
            const textInput = document.getElementById('textInput');
            
            const contentArray = themes[currentMode][themeKey];
            textInput.value = contentArray.join('\n');

            generateTracingText();
        }
        
        function drawLine(svg, yPosition, isTopLine = false) {
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute('x1', 0);
            line.setAttribute('y1', yPosition);
            line.setAttribute('x2', '100%'); 
            line.setAttribute('y2', yPosition);
            
            // Primary writing line is solid black, midline is dashed
            const strokeColor = isTopLine ? '#ccc' : 'black';
            const strokeDash = isTopLine ? '5,5' : 'none'; 
            
            line.style.cssText = `
                stroke: ${strokeColor};
                stroke-width: 1.5;
                stroke-dasharray: ${strokeDash};
            `;
            svg.appendChild(line);
        }

        function generateTracingText() {
            let linesToTrace = document.getElementById('textInput').value
                                .split('\n')
                                .map(line => line.trim())
                                .filter(line => line.length > 0);
            
            const fontStyle = document.getElementById('fontStyle').value;
            const fontSize = parseFloat(document.getElementById('fontSize').value); // Get user-selected size
            const textCase = document.getElementById('textCase').value;
            const svg = document.getElementById('tracingSVG');

            // Dynamic Line Height based on Font Size
            const LINE_HEIGHT = fontSize / BASELINE_ADJUSTMENT; // Calculate line spacing
            
            // --- 1. Apply Case Setting to ALL lines ---
            if (textCase === 'uppercase') {
                linesToTrace = linesToTrace.map(line => line.toUpperCase());
            } else if (textCase === 'lowercase') {
                linesToTrace = linesToTrace.map(line => line.toLowerCase());
            }
            
            // Clear previous content
            svg.innerHTML = ''; 
            
            // --- 2. Determine Font Family ---
            let fontFamily = (fontStyle === 'cursive') 
                ? 'Dancing Script, cursive' 
                : 'Arial Black, sans-serif'; 

            let maxLineWidth = 1000;
            
            // --- 3. Loop, Create Lines and Text ---
            linesToTrace.forEach((line, index) => {
                // Calculate the Y position for the writing baseline (the black line)
                const baselineY = START_Y + (index * LINE_HEIGHT);
                
                // Draw the primary writing line (bottom line)
                drawLine(svg, baselineY, false); 
                
                // Calculate the Y position for the tracing text
                // We move the text UP from the line by a fraction of the font size
                const textY = baselineY - (fontSize * TEXT_Y_OFFSET); 

                const textElement = document.createElementNS("http://www.w3.org/2000/svg", "text");
                
                textElement.textContent = line;
                textElement.setAttribute('x', START_X);
                textElement.setAttribute('y', textY); 
                textElement.setAttribute('dominant-baseline', 'alphabetic'); 
                
                // Apply the tracing styles
                textElement.style.cssText = `
                    font-family: ${fontFamily};
                    font-size: ${fontSize}px;
                    fill: none;
                    stroke: #999;
                    stroke-width: 2px;
                    stroke-dasharray: 8 4;
                `;
                
                svg.appendChild(textElement);
                
                // Update max width
                maxLineWidth = Math.max(maxLineWidth, line.length * (fontSize * 0.7)); // Rough estimate
            });
            
            // --- 4. Adjust SVG Height and ViewBox ---
            // Ensure there is space below the last line
            const requiredHeight = (linesToTrace.length * LINE_HEIGHT) + START_Y + 50; 
            
            svg.setAttribute('height', Math.max(450, requiredHeight));
            svg.setAttribute('viewBox', `0 0 ${maxLineWidth} ${Math.max(450, requiredHeight)}`);
        }

        function copySVGCode() {
            const outputDiv = document.getElementById('outputArea');
            const clone = outputDiv.cloneNode(true);

            // Clean the clone before copying
            const controls = clone.querySelector('#controls');
            if (controls) controls.remove();
            
            const header = clone.querySelector('#worksheetHeader').outerHTML;
            const svgCode = clone.querySelector('#tracingSVG').outerHTML;
            
            const fullCode = header + svgCode;

            navigator.clipboard.writeText(fullCode)
                .then(() => {
                    alert("Worksheet HTML/SVG copied to clipboard! (Includes Header)");
                })
                .catch(err => {
                    console.error('Could not copy text: ', err);
                    alert("Failed to copy code.");
                });
        }
    </script>
</body>
</html>
